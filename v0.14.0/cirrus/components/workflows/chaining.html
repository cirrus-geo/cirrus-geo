<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workflow chaining &mdash; cirrus-geo  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
        <script src="../../../_static/js/versions-loader.js?v=d43487cb"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Workflow callbacks" href="callbacks.html" />
    <link rel="prev" title="Batch tasks in workflows" href="batch.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            cirrus-geo
          </a>
              <div class="version">
                v0.14.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Cirrus documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../10_intro.html">Getting started with Cirrus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../20_arch.html">Cirrus architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../30_payload.html">Cirrus Process Payload</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../40_config-deploy.html">Configuration and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../50_operation.html">Basic Operation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../60_components.html">Cirrus Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../lambdas.html">Lambda-based components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../feeders.html">Feeders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks/index.html">Tasks</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Workflows</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="definitions.html">Writing workflow definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="batch.html">Batch tasks in workflows</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Workflow chaining</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#filtering-output-items">Filtering output items</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="callbacks.html">Workflow callbacks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../functions.html">Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../65_cloudformation.html">Cloudformation Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../70_statedb.html">State Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../80_monitoring.html">Pipeline Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../90_examples.html">Cirrus Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Component READMEs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../components/feeders/index.html">Feeders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../components/functions/index.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../components/tasks/index.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../components/workflows/index.html">Workflows</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">cirrus-geo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../60_components.html">Cirrus Components</a></li>
          <li class="breadcrumb-item"><a href="index.html">Workflows</a></li>
      <li class="breadcrumb-item active">Workflow chaining</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/cirrus/components/workflows/chaining.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="workflow-chaining">
<h1>Workflow chaining<a class="headerlink" href="#workflow-chaining" title="Link to this heading"></a></h1>
<p>Workflow chaining is a mechanism to allow multiple workflow executions to be
chained together in a declarative fashion, such that the output of one becomes
the inputs of the next. Chaining is implemented as an extension to the Cirrus
Process Payload format via support for an array of process definitions under the
payload <code class="docutils literal notranslate"><span class="pre">process</span></code> key, where each element in that <code class="docutils literal notranslate"><span class="pre">process</span></code> array represents
a link in the chain. The payload for the simple case of two chained workflows
would have a <code class="docutils literal notranslate"><span class="pre">process</span></code> array something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="o">&lt;</span><span class="n">workflow</span> <span class="mi">1</span> <span class="n">definition</span><span class="o">&gt;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="o">&lt;</span><span class="n">workflow</span> <span class="mi">2</span> <span class="n">definition</span><span class="o">&gt;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This example models a simple chain:</p>
<div class="mermaid">
            flowchart LR
  1(Workflow 1)
  2(Workflow 2)
  1 --&gt; 2
        </div><p>In this case, the Cirrus Process Payload output from <code class="docutils literal notranslate"><span class="pre">workflow</span> <span class="pre">1</span></code> is passed as
the input to <code class="docutils literal notranslate"><span class="pre">workflow</span> <span class="pre">2</span></code> after</p>
<ul class="simple">
<li><p>popping the <code class="docutils literal notranslate"><span class="pre">workflow</span> <span class="pre">1</span></code> process definition from the array.</p></li>
<li><p>deleting the payload <code class="docutils literal notranslate"><span class="pre">id</span></code> (as the <code class="docutils literal notranslate"><span class="pre">id</span></code> necessarily has to be different for
the <code class="docutils literal notranslate"><span class="pre">workflow</span> <span class="pre">2</span></code> execution).</p></li>
</ul>
<p>Each step in the workflow chain additionally supports a nested array, to model
branching within the chain. For example, the following would branch into two
separate workflow executions after the end of <code class="docutils literal notranslate"><span class="pre">workflow</span> <span class="pre">1</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="o">&lt;</span><span class="n">workflow</span> <span class="mi">1</span> <span class="n">definition</span><span class="o">&gt;</span> <span class="p">},</span>
    <span class="p">[{</span> <span class="o">&lt;</span><span class="n">workflow</span> <span class="mi">2</span><span class="n">a</span> <span class="n">definition</span><span class="o">&gt;</span> <span class="p">},</span> <span class="p">{</span> <span class="o">&lt;</span><span class="n">workflow</span> <span class="mi">2</span><span class="n">b</span> <span class="n">definition</span><span class="o">&gt;</span> <span class="p">}],</span>
    <span class="p">{</span> <span class="o">&lt;</span><span class="n">workflow</span> <span class="mi">3</span> <span class="n">definition</span><span class="o">&gt;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This example would result in an execution chain that looks like this:</p>
<div class="mermaid">
            flowchart LR
  1(Workflow 1)
  2a(Workflow 2a)
  2b(Workflow 2b)
  3a(Workflow 3)
  3b(Workflow 3)
  1  --&gt; 2a
  1  --&gt; 2b
  2a --&gt; 3a
  2b --&gt; 3b
        </div><p>Note that chaining alone can effectively model one-to-one and one-to-many
dependency relationships. If needing to model many-to-one or many-to-many
relationships, see <a class="reference internal" href="callbacks.html"><span class="doc">workflow callbacks</span></a> for an effective way
to consolidate the outputs of multiple workflows together.</p>
<section id="filtering-output-items">
<h2>Filtering output items<a class="headerlink" href="#filtering-output-items" title="Link to this heading"></a></h2>
<p>In cases where a successive workflow in a chain does not need all items produced
by an multi-output-item proceeding workflow, chaining supports an output item
filter via a <a class="reference external" href="https://goessner.net/articles/JsonPath/index.html">JSONPath</a> filter expression. To set such a filter, specify it in
the successive workflow’s process definition using the <cite>chain_filter</cite> key. For
example, if we only wanted items with an <code class="docutils literal notranslate"><span class="pre">id</span></code> starting with <code class="docutils literal notranslate"><span class="pre">SWE</span></code> that had a
<code class="docutils literal notranslate"><span class="pre">confidence</span></code> property greater than 80, we could do something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="o">&lt;</span><span class="n">workflow</span> <span class="mi">1</span> <span class="n">definition</span><span class="o">&gt;</span> <span class="p">},</span>
    <span class="p">{</span>
        <span class="o">&lt;</span><span class="n">workflow</span> <span class="mi">2</span> <span class="n">definition</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="s2">&quot;chain_filter&quot;</span><span class="p">:</span> <span class="s2">&quot;@.id =~ &#39;SWE*&#39; &amp; @.properties.confidence &gt; 80&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">chain_filter</span></code> string is specifically a JSONPath filter expression string
to apply to the output payload features. In other words, the above filter
expression example actually results in the following JSONPath query applied
against the JSON <code class="docutils literal notranslate"><span class="pre">workflow</span> <span class="pre">1</span></code> output payload:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$.features[?(@.id =~ &#39;SWE*&#39; &amp; @.properties.confidence &gt; 80)]
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="batch.html" class="btn btn-neutral float-left" title="Batch tasks in workflows" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="callbacks.html" class="btn btn-neutral float-right" title="Workflow callbacks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Element 84.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div
  class="rst-versions"
  data-toggle="rst-versions"
  role="note"
  aria-label="Versions"
>
  <span class="rst-current-version" data-toggle="rst-current-version">
    v: v0.14.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="versions-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>