

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>State Database &mdash; Cirrus  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/js/versions-loader.js?v=38b9fbf7"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pipeline Monitoring" href="80_monitoring.html" />
    <link rel="prev" title="Cloudformation Support" href="65_cloudformation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Cirrus
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Cirrus documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="10_intro.html">Getting started with Cirrus</a></li>
<li class="toctree-l1"><a class="reference internal" href="20_arch.html">Cirrus architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="30_payload.html">Cirrus Payload</a></li>
<li class="toctree-l1"><a class="reference internal" href="40_config-deploy.html">Configuration and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="50_operation.html">Basic Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="60_components.html">Cirrus Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="65_cloudformation.html">Cloudformation Support</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">State Database</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-dynamodb">What is DynamoDB?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#why-dynamodb">Why DynamoDB?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#managed-service">Managed Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#schema">Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="#statedb-and-cirrus-cli">StateDB and Cirrus CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deleting-statedb-items">Deleting StateDB items</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="80_monitoring.html">Pipeline Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="90_examples.html">Cirrus Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="95_tips_and_tricks.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="96_deploying.html">Deploying</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Component READMEs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../components/functions/index.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/tasks/index.html">Tasks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cirrus CLI READMEs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli/00_intro.html">CLIrrus Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/01_install.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/02_auth.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/03_deployments.html">CLIrrus and Cirrus Deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/04_commands.html">Command Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cirrus</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">State Database</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/cirrus/70_statedb.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="state-database">
<h1>State Database<a class="headerlink" href="#state-database" title="Link to this heading"></a></h1>
<p>The state database (StateDB) is a serverless Amazon Web Services (AWS) DynamoDB
table used by Cirrus to track the state of workflows executions.  As seen
in the <a class="reference internal" href="20_arch.html"><span class="doc">architecture</span></a> the StateDB is an independant piece of AWS
infrastructure.  It is a critical component of Cirrus that ensures workflow
state and executions are properly tracked as part of <a class="reference internal" href="80_monitoring.html"><span class="doc">monitoring</span></a> pipeline success, failure, errors, avoiding duplicate
workflows, and flagging invalid payloads.</p>
<p>The StateDB is accessed by Cirrus at different stages of workflow execution.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">process</span></code> lambda: acesses the StateDB to check existing states and skip
payloads that have successfully completed, and fire off TimeStream events in
the event of encountering an already “failed” or “invalid” payload.  It will
also make state updates upon initializing a workflow execution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">api</span></code> lambda: when queried for aggregate statistics, the lambada will call
the StateDB to get execution summary counts based on query inputs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_state</span></code> lambda: updates StateDB table after step function workflow
execution termination, successful or not.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">management</span></code> cli: directly connects to the StateDB to get workflow status,
inputs, and outputs.</p></li>
</ul>
<section id="what-is-dynamodb">
<h2>What is DynamoDB?<a class="headerlink" href="#what-is-dynamodb" title="Link to this heading"></a></h2>
<p>DynamoDB is a serverless, highly scalable non-relational (NoSQL) database
provisioned and managed by AWS.  This means that DynamoDB is a “key-value”
database, not a relational database like Postgres or AWS RDS.  In a NoSQL
database like DynamoDB there are ‘items’ and each item has ‘attributes’, and
items are independant of each other.  This simplified structures allows
DynamoDB to be optimized for read/write at any scale.</p>
<p>Additionally as a NoSQL database, DynamoDB does not require a predefined
schema and permits different items to have different attributes unlike the
rigid schemas of relational databases, providing flexibility for users to add
attributes if needed.</p>
</section>
<section id="why-dynamodb">
<h2>Why DynamoDB?<a class="headerlink" href="#why-dynamodb" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>serverless</p></li>
<li><p>optimized for scalable read/write</p></li>
<li><p>non-relational</p></li>
</ul>
<p>Cirrus itself handles business logic regarding when and how to make updates to
the StateDB and with no relationships between distinct workflow executions, the
StateDB only needs a “key-value” store for lookup.  As a managed, scalabale
“key-value” store DynamoDB is the AWS service that best meets Cirrus needs.</p>
</section>
<section id="managed-service">
<h2>Managed Service<a class="headerlink" href="#managed-service" title="Link to this heading"></a></h2>
<p>As a managed AWS service DynamoDB handles provisoning and maintaining the
underlying storage and scaling infrastructure as your data scales up or down.
This allows Cirrus to focus on the business logic of state management.
Additonally, DynamoDB is optimized by AWS for rapid read/writes at any scale.</p>
</section>
<section id="schema">
<h2>Schema<a class="headerlink" href="#schema" title="Link to this heading"></a></h2>
<p>While DynamoDB does not necessitate a predefined schema like a relational
databse, there are attributes that are required for core Cirrus functionality.</p>
<p>Required Fields:
These fields are required for out-of-the-box functionality of Cirrus</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">collections_workflow</span></code> (<em>string</em>):  a unique “partition key” constructed
from a Cirrus payload’s <code class="docutils literal notranslate"><span class="pre">payload_id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">itemIDs</span></code> (<em>string</em>): a unique ID field extrated from a payload ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">created</span></code> (<em>string</em>): UTC time when record was created</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">executions</span></code> (<em>list[string]</em>): ARNs of state machine executions.  May have
multiple records in this field if a payload is submitted multiple time, or
part of chained workflows</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">state_updated</span></code> (<em>string</em>): Concatenated string of state + UTC time of last
updated</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">updated</span></code> (<em>string</em>): UTC time when the record was most recently updated</p></li>
</ul>
</section>
<section id="statedb-and-cirrus-cli">
<h2>StateDB and Cirrus CLI<a class="headerlink" href="#statedb-and-cirrus-cli" title="Link to this heading"></a></h2>
<p>Selected Cirrus CLI commands interact with the StateDB.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">get-payloads</span></code> command takes in query parameters to retrieve input
payloads in bulk, returned as new line delimited JSON.</p>
<p>Input query parameters are used as filters against the StateDB to retrieve
records matching certain criteria, like entires with a <code class="docutils literal notranslate"><span class="pre">FAILED</span></code> workflow
status that occured in the past week.  These returned StateDB records are used
to retrieve input payloads from the S3 payload bucket which are returned to the
user.</p>
<p>More information about the <code class="docutils literal notranslate"><span class="pre">get-payloads</span></code> command can be found in the CLI
documentation</p>
</section>
<section id="deleting-statedb-items">
<h2>Deleting StateDB items<a class="headerlink" href="#deleting-statedb-items" title="Link to this heading"></a></h2>
<p>The deletion of records from the StateDB is not generally necessary.  In the
unlikely case doing so required, the <cite>cirrus.statedb.StateDB.delete_item()`</cite>
method can be used to delete a state record based on its <code class="docutils literal notranslate"><span class="pre">payload_id</span></code>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="65_cloudformation.html" class="btn btn-neutral float-left" title="Cloudformation Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="80_monitoring.html" class="btn btn-neutral float-right" title="Pipeline Monitoring" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 - 2024, Element 84.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div
  class="rst-versions"
  data-toggle="rst-versions"
  role="note"
  aria-label="Versions"
>
  <span class="rst-current-version" data-toggle="rst-current-version">
    v: v1.1.2
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="versions-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>